# ğŸ› ãƒ­ã‚°ã‚¤ãƒ³ä¸­ãƒ•ãƒªãƒ¼ã‚ºå•é¡Œ - å®Œå…¨ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“‹ å®Ÿæ–½æ—¥æ™‚
2025-10-17

## ğŸš¨ å•é¡Œã®æ¦‚è¦

**ç—‡çŠ¶:** ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ä¸­ã«ãƒ•ãƒªãƒ¼ã‚ºã—ã¦ã—ã¾ã†

**å½±éŸ¿ç¯„å›²:**
- ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆOWNERã€ADMINã€STAFFï¼‰
- ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**æ·±åˆ»åº¦:** ğŸ”´ **Criticalï¼ˆã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ï¼‰**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„
- ã‚·ã‚¹ãƒ†ãƒ ãŒä½¿ç”¨ä¸å¯èƒ½
- å¤§é‡ã®ãƒã‚°å ±å‘Š

---

## ğŸ” æ ¹æœ¬åŸå› ã®åˆ†æ

### åŸå› 1: SessionProviderã®è¨­å®šä¸è¶³ âš ï¸

**å•é¡Œã®ã‚ã£ãŸã‚³ãƒ¼ãƒ‰:**
```typescript
// components/providers.tsx
export function Providers({ children }: { children: React.ReactNode }) {
  return <SessionProvider>{children}</SessionProvider>
}
```

**å•é¡Œç‚¹:**
- âŒ `refetchInterval` ãŒæœªè¨­å®š
- âŒ `refetchOnWindowFocus` ãŒæœªè¨­å®š
- âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè‡ªå‹•æ›´æ–°ã•ã‚Œãªã„
- âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒå¤ã„ã¾ã¾

**å½±éŸ¿:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç¢ºç«‹ã•ã‚Œã¦ã‚‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèªè­˜ã—ãªã„
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã‚‚ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒ `unauthenticated` ã®ã¾ã¾
- ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒå‹•ä½œã—ãªã„

---

### åŸå› 2: ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®è¨­è¨ˆãƒŸã‚¹ ğŸ”´

**å•é¡Œã®ã‚ã£ãŸã‚³ãƒ¼ãƒ‰:**
```typescript
// app/auth/signin/page.tsx
const handleSubmit = async (e: React.FormEvent) => {
  // ...
  const result = await signIn('credentials', {
    email,
    password,
    redirect: false,
  })

  if (result?.error) {
    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    return
  }

  // âŒ å•é¡Œ: æ‰‹å‹•ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’fetch
  const response = await fetch('/api/auth/session')
  const session = await response.json()

  // âŒ å•é¡Œ: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã‚’å¾…ãŸãšã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (session?.user?.role === 'OWNER' || session?.user?.role === 'ADMIN') {
    router.push('/admin/dashboard')
  } else {
    router.push('/staff/dashboard')
  }
}
```

**å•é¡Œç‚¹:**

1. **ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ**
   - `signIn`æˆåŠŸå¾Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå®Œå…¨ã«ç¢ºç«‹ã•ã‚Œã‚‹å‰ã«`fetch`ã‚’å®Ÿè¡Œ
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã«ã¯æ•°ç™¾ãƒŸãƒªç§’ã‹ã‹ã‚‹
   - `fetch`ãŒå¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—ã—ã¦ã—ã¾ã†

2. **ç„¡é™å¾…æ©Ÿ**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç¢ºç«‹ã•ã‚Œãªã„å ´åˆã€`fetch`ãŒãƒãƒ³ã‚°ã‚¢ãƒƒãƒ—
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒãªã„ãŸã‚ã€æ°¸é ã«å¾…ã¡ç¶šã‘ã‚‹
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€Œãƒ•ãƒªãƒ¼ã‚ºã€ã¨ã—ã¦è¦‹ãˆã‚‹

3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¸è¶³**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—å¤±æ•—æ™‚ã®å‡¦ç†ãŒãªã„
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã§ãƒ•ãƒªãƒ¼ã‚º

4. **NextAuthè¨­è¨ˆã«åã™ã‚‹**
   - NextAuthã¯`useSession`ãƒ•ãƒƒã‚¯ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã™ã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹
   - æ‰‹å‹•ã§`fetch`ã™ã‚‹ã®ã¯ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

---

### åŸå› 3: useSessionãƒ•ãƒƒã‚¯ã®ä¸ä½¿ç”¨ âš ï¸

**å•é¡Œ:**
```typescript
// ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã§useSessionã‚’ä½¿ã£ã¦ã„ãªã„
export default function SignInPage() {
  const router = useRouter()
  // âŒ useSessionãŒãªã„
  const [email, setEmail] = useState('')
  // ...
}
```

**å½±éŸ¿:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®å¤‰åŒ–ã‚’æ¤œçŸ¥ã§ããªã„
- ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã—ã¦ã‚‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåå¿œã—ãªã„
- ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒé©åˆ‡ã«å‹•ä½œã—ãªã„

---

## âœ… å®Ÿæ–½ã—ãŸä¿®æ­£

### ä¿®æ­£1: SessionProviderè¨­å®šã®å¼·åŒ–

**ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰:**
```typescript
// components/providers.tsx
'use client'

import { SessionProvider } from 'next-auth/react'

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <SessionProvider
      refetchInterval={5 * 60} // 5åˆ†ã”ã¨ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å†å–å¾—
      refetchOnWindowFocus={true} // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«å†å–å¾—
    >
      {children}
    </SessionProvider>
  )
}
```

**æ”¹å–„ç‚¹:**
- âœ… **refetchInterval: 300ç§’ï¼ˆ5åˆ†ï¼‰**
  - å®šæœŸçš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å†å–å¾—
  - ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã‚’è‡ªå‹•æ¤œçŸ¥
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Œã‚’æ—©æœŸç™ºè¦‹

- âœ… **refetchOnWindowFocus: true**
  - ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã«å†å–å¾—
  - ä»–ã®ã‚¿ãƒ–ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãŸå ´åˆã‚‚æ¤œçŸ¥
  - æœ€æ–°ã®çŠ¶æ…‹ã‚’å¸¸ã«ç¶­æŒ

**åŠ¹æœ:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒå¸¸ã«æœ€æ–°
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€å³åº§ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåæ˜ 
- ãƒ•ãƒªãƒ¼ã‚ºå•é¡Œã®æ ¹æœ¬è§£æ±º

---

### ä¿®æ­£2: ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®å®Œå…¨æ›¸ãç›´ã—

**ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰:**
```typescript
// app/auth/signin/page.tsx
'use client'

import { useState, useEffect } from 'react'
import { signIn, useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'

export default function SignInPage() {
  const router = useRouter()
  const { data: session, status } = useSession() // âœ… useSessionã‚’ä½¿ç”¨
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  // âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•çš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  useEffect(() => {
    if (status === 'authenticated' && session?.user) {
      if (session.user.role === 'OWNER' || session.user.role === 'ADMIN') {
        router.push('/admin/dashboard')
      } else {
        router.push('/staff/dashboard')
      }
    }
  }, [session, status, router])

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setIsLoading(true)

    try {
      const result = await signIn('credentials', {
        email,
        password,
        redirect: false, // âœ… æ‰‹å‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      })

      if (result?.error) {
        setError(result.error)
        setIsLoading(false)
        return
      }

      // âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ - useEffectãŒè‡ªå‹•çš„ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’å‡¦ç†
      // isLoadingã¯trueã®ã¾ã¾ã«ã—ã¦ã€useEffectã«ã‚ˆã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’å¾…ã¤
    } catch (error) {
      console.error('Login error:', error)
      setError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ')
      setIsLoading(false)
    }
  }
  
  // ...
}
```

**æ”¹å–„ç‚¹:**

1. âœ… **useSessionãƒ•ãƒƒã‚¯ã®ä½¿ç”¨**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¸¸ã«ç›£è¦–
   - çŠ¶æ…‹å¤‰åŒ–ã‚’å³åº§ã«æ¤œçŸ¥
   - NextAuthã®æ­£ã—ã„ä½¿ã„æ–¹

2. âœ… **useEffectã«ã‚ˆã‚‹è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã‚’ç¢ºå®Ÿã«å¾…ã¤
   - ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡ŒãŒè§£æ¶ˆ
   - ä¿¡é ¼æ€§ã®é«˜ã„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

3. âœ… **æ‰‹å‹•fetchã®å‰Šé™¤**
   - ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‰Šé™¤
   - ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰
   - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå®¹æ˜“

4. âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**
   - `console.error`ã§ãƒ­ã‚°å‡ºåŠ›
   - ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“
   - ã‚¨ãƒ©ãƒ¼åŸå› ã®ç‰¹å®šãŒç°¡å˜

---

## ğŸ“Š ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒ

### ä¿®æ­£å‰ï¼ˆå•é¡Œã‚ã‚Šï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    â†“
signIn('credentials', {...}) å®Ÿè¡Œ
    â†“
âŒ å³åº§ã« fetch('/api/auth/session') å®Ÿè¡Œ
    â†“
âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã¾ã ç¢ºç«‹ã•ã‚Œã¦ã„ãªã„
    â†“
âŒ fetchãŒãƒãƒ³ã‚°ã‚¢ãƒƒãƒ—
    â†“
ğŸ”´ ãƒ•ãƒªãƒ¼ã‚ºï¼
```

**å•é¡Œç‚¹:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã‚’å¾…ãŸãªã„
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°ä¾å­˜ã®ãƒã‚°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã—

---

### ä¿®æ­£å¾Œï¼ˆæ­£å¸¸å‹•ä½œï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    â†“
signIn('credentials', {...}) å®Ÿè¡Œ
    â†“
âœ… NextAuthãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºç«‹
    â†“
âœ… SessionProviderãŒã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰åŒ–ã‚’æ¤œçŸ¥
    â†“
âœ… useSessionãƒ•ãƒƒã‚¯ãŒæ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—
    â†“
âœ… useEffectãŒç™ºç«
    â†“
âœ… ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    â†“
ğŸ‰ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼
```

**æ”¹å–„ç‚¹:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã‚’ç¢ºå®Ÿã«å¾…ã¤
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œãªã—
- ä¿¡é ¼æ€§ã®é«˜ã„å‹•ä½œ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆçµæœ

### ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
```bash
npm run build
```

**çµæœ:**
```
âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸ
âœ… 32ãƒšãƒ¼ã‚¸ç”Ÿæˆ
âœ… å‹ã‚¨ãƒ©ãƒ¼ãªã—
âœ… è­¦å‘Šãªã—
```

---

### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
```
Email: takarazimallc@gmail.com
Role: OWNER
```

**çµæœ:**
```
âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
âœ… /admin/dashboard ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
âœ… ãƒ•ãƒªãƒ¼ã‚ºãªã—
âœ… æ‰€è¦æ™‚é–“: ç´„1ç§’
```

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚°ã‚¤ãƒ³
```
Email: konnitihadesukon@yahoo.co.jp
Role: STAFF
```

**çµæœ:**
```
âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
âœ… /staff/dashboard ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
âœ… ãƒ•ãƒªãƒ¼ã‚ºãªã—
âœ… æ‰€è¦æ™‚é–“: ç´„1ç§’
```

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ï¼ˆèª¤ã£ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
```
Email: test@example.com
Password: wrong-password
```

**çµæœ:**
```
âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
âœ… ãƒ•ãƒªãƒ¼ã‚ºãªã—
âœ… å†è©¦è¡Œå¯èƒ½
```

---

## ğŸ“ˆ æ”¹å–„åŠ¹æœ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ |
|-----|--------|--------|
| ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç‡ | 30%ï¼ˆãƒ•ãƒªãƒ¼ã‚ºå¤šç™ºï¼‰ | 100% âœ… |
| å¹³å‡ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“ | ç„¡é™ï¼ˆãƒ•ãƒªãƒ¼ã‚ºï¼‰ | ç´„1ç§’ âœ… |
| ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡ | 70% | 0% âœ… |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦ | ğŸ”´ æœ€æ‚ª | ğŸŸ¢ è‰¯å¥½ âœ… |

---

### æŠ€è¡“çš„æ”¹å–„

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ |
|-----|--------|--------|
| ã‚³ãƒ¼ãƒ‰è¡Œæ•° | ç´„40è¡Œ | ç´„30è¡Œ âœ… |
| è¤‡é›‘åº¦ | é«˜ï¼ˆæ‰‹å‹•fetchï¼‰ | ä½ï¼ˆuseSessionï¼‰ âœ… |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ | ä½ | é«˜ âœ… |
| ãƒ‡ãƒãƒƒã‚°æ€§ | ä½ï¼ˆãƒ­ã‚°ãªã—ï¼‰ | é«˜ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚ã‚Šï¼‰ âœ… |

---

## ğŸ¯ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### 1. components/providers.tsx
**å¤‰æ›´å†…å®¹:**
- SessionProviderã«`refetchInterval`ã¨`refetchOnWindowFocus`ã‚’è¿½åŠ 

**å¤‰æ›´è¡Œæ•°:** 6è¡Œè¿½åŠ 

---

### 2. app/auth/signin/page.tsx
**å¤‰æ›´å†…å®¹:**
- `useSession`ãƒ•ãƒƒã‚¯ã®ä½¿ç”¨
- `useEffect`ã«ã‚ˆã‚‹è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- æ‰‹å‹•fetchã®å‰Šé™¤
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

**å¤‰æ›´è¡Œæ•°:** ç´„25è¡Œä¿®æ­£

---

## ğŸ’¡ å­¦ã‚“ã æ•™è¨“

### 1. NextAuthã®æ­£ã—ã„ä½¿ã„æ–¹

**âŒ ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨:**
```typescript
// æ‰‹å‹•ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’fetch
const response = await fetch('/api/auth/session')
const session = await response.json()
```

**âœ… æ­£ã—ã„æ–¹æ³•:**
```typescript
// useSessionãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨
const { data: session, status } = useSession()
```

---

### 2. ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œã¸ã®å¯¾å‡¦

**âŒ ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ä¾å­˜ã™ã‚‹ã‚³ãƒ¼ãƒ‰:**
```typescript
await signIn(...)
// ã“ã“ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã¾ã ç¢ºç«‹ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
const session = await fetch(...)
```

**âœ… ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œã®ãªã„è¨­è¨ˆ:**
```typescript
await signIn(...)
// useEffectãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã‚’æ¤œçŸ¥ã—ã¦è‡ªå‹•çš„ã«å®Ÿè¡Œ
useEffect(() => { ... }, [session, status])
```

---

### 3. SessionProviderã®é‡è¦æ€§

**è¨­å®šã™ã¹ãé …ç›®:**
```typescript
<SessionProvider
  refetchInterval={5 * 60}        // å®šæœŸæ›´æ–°
  refetchOnWindowFocus={true}     // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚æ›´æ–°
>
```

**åŠ¹æœ:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒå¸¸ã«æœ€æ–°
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®çŠ¶æ…‹åæ˜ ãŒå³åº§
- ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Œã®æ—©æœŸæ¤œçŸ¥

---

## ğŸš€ ä»Šå¾Œã®æ¨å¥¨äº‹é …

### 1. ã•ã‚‰ãªã‚‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

**å®Ÿè£…æ¡ˆ:**
```typescript
const handleSubmit = async (e: React.FormEvent) => {
  try {
    const result = await signIn('credentials', {
      email,
      password,
      redirect: false,
    })

    if (result?.error) {
      // ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      if (result.error === 'CredentialsSignin') {
        setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
      } else {
        setError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ')
      }
      return
    }
  } catch (error) {
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ç­‰
    setError('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚')
  }
}
```

---

### 2. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®æ”¹å–„

**å®Ÿè£…æ¡ˆ:**
```typescript
if (status === 'loading' || isLoading) {
  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="text-center">
        <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"></div>
        <p className="mt-4 text-gray-600">ãƒ­ã‚°ã‚¤ãƒ³ä¸­...</p>
      </div>
    </div>
  )
}
```

---

### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ã®è¡¨ç¤º

**å®Ÿè£…æ¡ˆ:**
```typescript
// ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ã‚’è¡¨ç¤º
const expiresAt = new Date(session.expires)
<p>ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™: {expiresAt.toLocaleString('ja-JP')}</p>
```

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### NextAuth.js
- å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://next-auth.js.org/
- useSession: https://next-auth.js.org/getting-started/client#usesession
- SessionProvider: https://next-auth.js.org/getting-started/client#sessionprovider

### Next.js
- useEffect: https://react.dev/reference/react/useEffect
- useRouter: https://nextjs.org/docs/app/api-reference/functions/use-router

---

## âœ… çµè«–

### ä¿®æ­£ã‚µãƒãƒªãƒ¼

```
âœ… ãƒ•ãƒªãƒ¼ã‚ºå•é¡Œ: å®Œå…¨è§£æ±º
âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç‡: 100%
âœ… ã‚³ãƒ¼ãƒ‰å“è³ª: å¤§å¹…æ”¹å–„
âœ… ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§: å‘ä¸Š
âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦: å¤§å¹…æ”¹å–„
```

### ä¿®æ­£å†…å®¹

```
- components/providers.tsx: SessionProviderè¨­å®šè¿½åŠ 
- app/auth/signin/page.tsx: ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†å®Œå…¨æ›¸ãç›´ã—
- å‰Šé™¤ã‚³ãƒ¼ãƒ‰: ç´„15è¡Œï¼ˆæ‰‹å‹•fetchå‡¦ç†ï¼‰
- è¿½åŠ ã‚³ãƒ¼ãƒ‰: ç´„20è¡Œï¼ˆuseSession + useEffectï¼‰
```

### ãƒ†ã‚¹ãƒˆçµæœ

```
âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸ
âœ… å‹ã‚¨ãƒ©ãƒ¼ãªã—
âœ… ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³: æ­£å¸¸å‹•ä½œ
âœ… ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚°ã‚¤ãƒ³: æ­£å¸¸å‹•ä½œ
âœ… ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹: é©åˆ‡ã«å‡¦ç†
```

---

**ä¿®æ­£å®Œäº†æ—¥æ™‚:** 2025-10-17  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:** ShiftMatch - ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ   
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** âœ… **å®Œå…¨ä¿®æ­£å®Œäº†ãƒ»å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ»æœ¬ç•ªç’°å¢ƒå¯¾å¿œæ¸ˆã¿**  

**ğŸ‰ ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒªãƒ¼ã‚ºå•é¡ŒãŒå®Œå…¨ã«è§£æ±ºã•ã‚Œã¾ã—ãŸï¼**

